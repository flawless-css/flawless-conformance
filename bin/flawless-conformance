#!/usr/bin/env node

var fs = require( 'fs' )
var path = require( 'path' )
var argv = require( 'minimist' )( process.argv.slice( 2 ) )
var Conformance = require( '../dist' )


// Conformance options
var entry = argv.e || 'input'
var paths = [
    './node_modules'
]
if ( argv.e ) {
    paths.push( path.dirname( argv.e ) )
}
if ( argv.p ) {
    argv.p.split( ',' ).forEach( function( importPath ) {
        paths.push( importPath )
    })
}

var conformance = new Conformance({
    paths: paths,
    entry: entry
})


// Stream handlers
var input = ''
function onData( chunk ) {
    if ( chunk !== null ) {
        input += chunk
    }
}
function onEnd() {
    conformance.parse( input )
}


// Get the data
var stream = argv.e ? fs.createReadStream( argv.e ) : process.stdin
stream.on( 'data', onData )
stream.on( 'end', onEnd )
